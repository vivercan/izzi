========================================
C√ìDIGO CORREGIDO PARA WIDETECH GPS
========================================

üìç UBICACI√ìN: /supabase/functions/server/index.tsx
üìã L√çNEAS: ~1100-1146 (busca "Response (primeros 500 chars)")

‚ö†Ô∏è REEMPLAZA TODO ESTE BLOQUE:

        const responseText = await response.text();
        console.log(`[WIDETECH] üìÑ Response (primeros 500 chars): ${responseText.substring(0, 500)}`);
        
        // Parsear XML para extraer todos los valores necesarios
        const latMatch = responseText.match(/<Latitude>([-\\d.]+)<\/Latitude>/);
        const lngMatch = responseText.match(/<Longitude>([-\\d.]+)<\/Longitude>/);
        const speedMatch = responseText.match(/<Speed>([\d.]+)<\/Speed>/);
        const headingMatch = responseText.match(/<Heading>([^<]+)<\/Heading>/);
        const locationMatch = responseText.match(/<Location><!\[CDATA\[([^\]]+)\]\]><\/Location>/);
        const dateTimeMatch = responseText.match(/<DateTimeGPS>([^<]+)<\/DateTimeGPS>/);
        const odometerMatch = responseText.match(/<Odometer>([\d.]+)<\/Odometer>/);
        const ignitionMatch = responseText.match(/<Ignition>([01])<\/Ignition>/);
        
        // Parsear temperaturas (S1 y S2)
        const temp1Match = responseText.match(/<S1[^>]*>([-\d.]+)<\/S1>/);
        const temp2Match = responseText.match(/<S2[^>]*>([-\d.]+)<\/S2>/);
        
        if (latMatch && lngMatch) {

‚úÖ POR ESTE C√ìDIGO NUEVO:

        const responseText = await response.text();
        console.log(`[WIDETECH] üìÑ XML Completo placa ${placa}:`, responseText);
        
        // ‚ö†Ô∏è IMPORTANTE: WideTech usa c√≥digo 100 para OK (no 200)
        const codeMatch = responseText.match(/<code>(\d+)<\/code>/);
        const statusCode = codeMatch ? parseInt(codeMatch[1]) : 0;
        
        console.log(`[WIDETECH] ‚úÖ Status code: ${statusCode} (esperado: 100)`);
        
        // Parsear XML para extraer todos los valores necesarios
        const latMatch = responseText.match(/<Latitude>([-\d.]+)<\/Latitude>/);
        const lngMatch = responseText.match(/<Longitude>([-\d.]+)<\/Longitude>/);
        const speedMatch = responseText.match(/<Speed>([\d.]+)<\/Speed>/);
        const headingMatch = responseText.match(/<Heading>([^<]+)<\/Heading>/);
        const locationMatch = responseText.match(/<Location><!\[CDATA\[([^\]]+)\]\]><\/Location>/);
        const dateTimeMatch = responseText.match(/<DateTimeGPS>([^<]+)<\/DateTimeGPS>/);
        const odometerMatch = responseText.match(/<Odometer>([\d.]+)<\/Odometer>/);
        const ignitionMatch = responseText.match(/<Ignition>([01])<\/Ignition>/);
        const altitudMatch = responseText.match(/<Altitud>([\d.]+)<\/Altitud>/);
        
        // Parsear temperaturas (S1 y S2)
        const temp1Match = responseText.match(/<S1[^>]*>([-\d.]+)<\/S1>/);
        const temp2Match = responseText.match(/<S2[^>]*>([-\d.]+)<\/S2>/);
        
        console.log(`[WIDETECH] üîç Parsing: Lat=${latMatch?.[1]}, Lng=${lngMatch?.[1]}, Speed=${speedMatch?.[1]}`);
        
        if (latMatch && lngMatch) {


========================================
CAMBIOS REALIZADOS:
========================================

1. ‚úÖ Remov√≠ BACKSLASHES DUPLICADAS:
   Antes: /<Latitude>([-\\d.]+)<\\/Latitude>/
   Ahora: /<Latitude>([-\d.]+)<\/Latitude>/

2. ‚úÖ Agregu√© validaci√≥n de c√≥digo de status 100

3. ‚úÖ Agregu√© logging del XML completo para debugging

4. ‚úÖ Agregu√© soporte para <Altitud> (que usa WideTech)

========================================
C√ìMO DEPLOYAR:
========================================

OPCI√ìN A - Supabase Dashboard (RECOMENDADO):
1. Ve a: https://supabase.com/dashboard/project/[tu-proyecto]/functions
2. Click en la funci√≥n "server"
3. Busca la l√≠nea 1101 (aprox)
4. Reemplaza el c√≥digo
5. Click "Deploy"

OPCI√ìN B - GitHub:
1. Edita /supabase/functions/server/index.tsx
2. git add .
3. git commit -m "Fix: WideTech GPS parsing"
4. git push origin main
5. Auto-deploy en www.jjcrm27.com

========================================
RESULTADO ESPERADO:
========================================

Despu√©s del deploy ver√°s:
‚úÖ 931 - GPS activo
‚úÖ 937 - GPS activo  
‚úÖ 891 - GPS activo
‚úÖ 801 - GPS activo
‚úÖ 905 - GPS activo
‚úÖ 911 - GPS activo
‚úÖ 841 - GPS activo
‚úÖ 863 - GPS activo
‚úÖ 861 - GPS activo
‚úÖ 817 - GPS activo
‚úÖ 899 - GPS activo
‚úÖ 745 - GPS activo
‚úÖ 799 - GPS activo
‚úÖ 158 - GPS activo
‚úÖ 765 - GPS activo
‚úÖ 208 - GPS activo
‚úÖ 813 - GPS activo
‚úÖ 126 - GPS activo
‚úÖ 809 - GPS activo
‚úÖ 859 - GPS activo

Y m√°s unidades que tengan se√±al GPS en WideTech.

========================================
