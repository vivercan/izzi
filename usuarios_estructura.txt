
> const USUARIOS_AUTORIZADOS: Usuario[] = [
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // ADMINISTRADORES (2) - Acceso TOTAL a todo
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    {
      id: '1',
      nombre: 'Juan Viveros',
      correo: 'juan.viveros@trob.com.mx',
      password: 'Mexico86',
      rol: 'admin',
      rolDisplay: 'ADMIN',
      ultimoAcceso: '',
      activo: true,
      createdAt: '2025-01-01T00:00:00.000Z'
    },
    {
      id: '9',
      nombre: 'Jennifer S√°nchez',
      correo: 'jennifer.sanchez@trob.com.mx',
      password: 'jsanchez',
      rol: 'admin',
      rolDisplay: 'ADMIN',
      ultimoAcceso: '',
      activo: true,
      createdAt: '2025-12-17T00:00:00.000Z'
    },
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // CSR (2) - Todo menos Config, VEN TODO en m√≥dulos de datos
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    {
      id: '7',
      nombre: 'Lizeth Rodr√≠guez',
      correo: 'customer.service3@trob.com.mx',
      password: 'lrodriguez',
      rol: 'csr',
      rolDisplay: 'CSR',
      ultimoAcceso: '',
      activo: true,
      createdAt: '2025-01-05T00:00:00.000Z'
    },
    {
      id: '8',
      nombre: 'Elizabeth Rodr√≠guez',
      correo: 'customer.service1@trob.com.mx',
      password: 'erodriguez',
      rol: 'csr',
      rolDisplay: 'CSR',
      ultimoAcceso: '',
      activo: true,
      createdAt: '2025-01-05T00:00:00.000Z'
    },
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // VENTAS (2) - Todo menos Config, SOLO SUS DATOS en Ventas/Oportunidades
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    {
      id: '4',
      nombre: 'Isis Estrada',
      correo: 'isis.estrada@wexpress.com.mx',
      password: 'iestrada',
      rol: 'ventas',
      rolDisplay: 'VENTAS',
      vendedorVentas: 'ISIS',        // Valor en ventas_maestro.ejecutivo_ventas
      vendedorLeads: 'Isis Estrada', // Valor en leads.vendedor (nombre completo)
      ultimoAcceso: '',
      activo: true,
      createdAt: '2025-01-03T00:00:00.000Z'
    },
    {
      id: '5',
      nombre: 'Paloma Oliva',
      correo: 'paloma.oliva@speedyhaul.com.mx',
      password: 'poliva',
      rol: 'ventas',
      rolDisplay: 'VENTAS',
      vendedorVentas: 'PALOMA',      // Valor en ventas_maestro.ejecutivo_ventas
      vendedorLeads: 'Paloma Oliva', // Valor en leads.vendedor (nombre completo)
      ultimoAcceso: '',
      activo: false,
      createdAt: '2025-01-03T00:00:00.000Z'
    },
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // OPERACIONES (3) - SOLO m√≥dulo Dedicado, sin acceso a Ventas/Oportunidades
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    {
      id: '2',
      nombre: 'Jos√© Rodr√≠guez',
      correo: 'jose.rodriguez@trob.com.mx',
      password: 'jrodriguez',
      rol: 'operaciones',
      rolDisplay: 'OPERACIONES',
      ultimoAcceso: '',
      activo: true,
      createdAt: '2025-01-02T00:00:00.000Z'
    },
    {
      id: '3',
      nombre: 'Marcos Pineda',
      correo: 'marcos.pineda@trob.com.mx',
      password: 'mpineda',
      rol: 'operaciones',
      rolDisplay: 'OPERACIONES',
>     localStorage.setItem('fx27-usuarios', JSON.stringify(USUARIOS_AUTORIZADOS));
  
      const savedSession = localStorage.getItem('fx27-session');
      if (savedSession) {
        try {
          const session = JSON.parse(savedSession);
>         const usuario = USUARIOS_AUTORIZADOS.find(u => u.correo === session.email && u.activo);
          if (usuario) {
            setIsLoggedIn(true);
            setUserRole(usuario.rol);
            setUserRolDisplay(usuario.rolDisplay);
            setUserVendedorVentas(usuario.vendedorVentas || '');
            setUserVendedorLeads(usuario.vendedorLeads || '');
            setUserPermisosCustom(usuario.permisosCustom || []);
            setCurrentUserEmail(session.email);
            setCurrentUserName(usuario.nombre);
            console.log('‚úÖ Sesi√≥n restaurada:', usuario.nombre, '| Ventas:', usuario.vendedorVentas || 'TODO', '| Leads:', usuario.vendedorLeads || 'TODO');
          } else {
            localStorage.removeItem('fx27-session');
          }
        } catch (e) {
          localStorage.removeItem('fx27-session');
        }
      }
    }, []);
  
    // üîê LOGIN
    const handleLogin = (email: string, password: string) => {
      console.log('üîê Login:', email);
      setLoginError('');
  
>     const usuario = USUARIOS_AUTORIZADOS.find(u =>
        u.correo === email && u.password === password && u.activo
      );
  
      if (!usuario) {
        setLoginError('Credenciales incorrectas. Verifica tu email y contrase√±a.');
        return;
      }
  
      console.log('‚úÖ Login OK:', usuario.nombre, '| Rol:', usuario.rolDisplay);
      console.log('   ‚Üí Ventas filtro:', usuario.vendedorVentas || 'VER TODO');
      console.log('   ‚Üí Leads filtro:', usuario.vendedorLeads || 'VER TODO');
  
      setUserRole(usuario.rol);
      setUserRolDisplay(usuario.rolDisplay);
      setUserVendedorVentas(usuario.vendedorVentas || '');
      setUserVendedorLeads(usuario.vendedorLeads || '');
      setUserPermisosCustom(usuario.permisosCustom || []);
      setIsLoggedIn(true);
      setCurrentUserEmail(email);
      setCurrentUserName(usuario.nombre);
  
      localStorage.setItem('fx27-session', JSON.stringify({
        role: usuario.rol,
        rolDisplay: usuario.rolDisplay,
        vendedorVentas: usuario.vendedorVentas || '',
        vendedorLeads: usuario.vendedorLeads || '',
        permisosCustom: usuario.permisosCustom || [],
        email: email,
        name: usuario.nombre,
        timestamp: new Date().toISOString()
      }));
  
      // Actualizar √∫ltimo acceso
      fetch(`https://${projectId}.supabase.co/functions/v1/make-server-d84b50bb/usuarios/ultimo-acceso`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${publicAnonKey}` },
        body: JSON.stringify({ email })
      }).catch(() => {});
    };
  
    const handleLogout = () => {
      setIsLoggedIn(false);
      setCurrentModule(null);
      setUserRole('admin');
      setUserRolDisplay('ADMIN');
      setUserVendedorVentas('');
      setUserVendedorLeads('');
      setUserPermisosCustom([]);
      setCurrentUserEmail('');
      setCurrentUserName('');
      localStorage.removeItem('fx27-session');
    };
  
    const handleNavigate = (module: string) => {
      if (!checkModuleAccess(module, userRole, userPermisosCustom)) {
        alert('‚ö†Ô∏è Acceso Restringido\n\nNo tienes permisos para este m√≥dulo.');
        return;
      }
      setCurrentModule(module);
    };
  
    const handleBack = () => setCurrentModule(null);
  
    // üîí PERMISOS POR ROL
    const checkModuleAccess = (module: string, role: UserRole, permisosCustom: string[] = []): boolean => {
      if (role === 'admin') return true;
      if (role === 'csr') return module !== 'configuracion';
      if (role === 'ventas') return module !== 'configuracion';
      if (role === 'operaciones') {
        return ['dedicados', 'admin-carroll', 'monitor-carroll', 'vista-clientes-carroll', 'mapa-climatico-carroll'].includes(module);
      }
      if (role === 'custom') return permisosCustom.includes(module);
      return false;
    };
  
    // Si es ruta p√∫blica, renderizar sin login
    if (rutaPublica) {
      if (rutaPublica.tipo === 'alta-cliente') {
        return <AltaClientePublico solicitudId={rutaPublica.id} />;
      }
    }
  
    return (
      <div className="w-full min-h-screen">
        {!isLoggedIn ? (
          <LoginScreen onLogin={handleLogin} loginError={loginError} />
        ) : currentModule ? (
          <>
            {currentModule === 'agregar-lead' && <AgregarLeadModule onBack={handleBack} />}
            {currentModule === 'panel-oportunidades' && (
              <PanelOportunidadesModule
                onBack={handleBack}
                userVendedorLeads={userVendedorLeads}  // Nombre completo para filtrar leads
              />
            )}
            {currentModule === 'operaciones' && <ModuleTemplate title="Operaciones" onBack={handleBack} headerImage={MODULE_IMAGES.OPERACIONES} />}
            {currentModule === 'despacho-inteligente' && <DespachoInteligenteModule onBack={handleBack} />}
            {currentModule === 'control-equipo' && <ControlEquipoModule onBack={handleBack} />}
            {currentModule === 'kpis' && <KPIsModule onBack={handleBack} />}
            {currentModule === 'configuracion' && <ConfiguracionModule onBack={handleBack} />}

